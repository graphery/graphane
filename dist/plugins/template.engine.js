/* graphane - 0.1.0-alpha.4 */ var lt="function",Z="undefined",F="object",pt="string",q="array",R="number";var S=t=>typeof t===F,A=t=>typeof t===pt,L=t=>typeof t===lt,v=t=>typeof t===R&&!isNaN(t),_=t=>typeof t===Z;var k=t=>Array.isArray(t);var z=new Map;function B(t,e){let n=`${t.join(",")} ${e}`;if(z.has(n))return z.get(n);let i=new Function(...t,e);return z.set(n,i),i}function mt(t){return t===null?null:t.constructor?new t.constructor:{}}function V(t){if(!S(t))return t;let e=t===null?null:Object.assign(mt(t),t);for(let n in e)S(e[n])&&(e[n]=V(e[n]));return e}function W(t,e){let n=t,i=A(e)?e.split("."):e;for(let u=0;u<i.length;u++){if(_(n[i[u]]))return;n=n[i[u]]}return n}var Y=Symbol(),J=Symbol();function dt(t,e){return e===Y?t:W(t,e)}function X(t){let e={};function n(o,l,T,w){return e[o]||(e[o]={}),(x=void 0,$=Y)=>{if(A(x)||_(x)){if($=x||Y,$ in e[o])return e[o][$]}else t=x;let y=t.reduce((E,r)=>{let c=dt(r,$);return typeof c>"u"?E:E===J?c:T(E,c)},l);return y=typeof w=="function"?w(y):y,t!==x&&(e[o][$]=y),y}}let i=n("min",J,(o,l)=>l>o?o:l),u=n("max",J,(o,l)=>l<o?o:l),f=n("count",0,o=>o+1),a=n("sum",0,(o,l)=>l+o),s=n("avg",{n:0,i:0},(o,l)=>(o.n++,o.i+=Number(l),o),o=>o.i/o.n),m=n("distinct",new Set,(o,l)=>(o.add(l),o),o=>[...o]);return{min:i,max:u,sum:a,count:f,avg:s,distinct:m}}var j="SVG",b="animate",ht="none",$t="freeze",yt="path",tt="d",gt="transform",it="rotate",H="translate",Nt="offset",et="inherit",nt="finished",xt=[it,"skewX","skewY"],Et="deg",D="px",rt="ms",St=["width","height"],K=!1;if(window.matchMedia){let t=window.matchMedia("(prefers-reduced-motion: reduce)");K=t.matches,t.addEventListener("change",()=>{K=t.matches})}var At=t=>t.replace(/([A-Z])/g,"-$1").toLowerCase();function Ot(t,e={duration:200},n=null,i=null){let u=this.gSVG,f=r=>{let c=S(r)?Object.assign({},r):{duration:r};return K&&(c.duration=0),c.fill=ht,c},a=r=>{r=k(r)?r:[r];let c=window.getComputedStyle(this._el),p=[],d=new Set;for(let N of r){let g=Object.assign({},N);for(let h in g)!(h in c)||St.includes(h)?d.add(h):h===tt?g.d=`${yt}("${g.d}")`:h===gt&&(g.transform=o(g.transform));p.push(g)}return m(d,p),p},s=[],m=(r,c)=>{if(r.size){let p=new KeyframeEffect(null,c).getKeyframes(),d=this.closest(j)?this.closest(j).getCurrentTime()*1e3:0;for(let N of r){let g=u(b).attributeName(N).dur($.duration+rt).begin((0|d+(e.delay||0))+rt).fill($t);if(c.length===1)g.to(c[0][N]);else{let h=[],M=[];for(let G in p){let at=p[G];N in c[G]&&(h.push(at.computedOffset),M.push(c[G][N]))}h[0]!==0&&(h.unshift(0),M.unshift(this[N]()||et)),h[h.length-1]!==1&&(h.push(1),M.push(this[N]()||et)),g.keyTimes(h.join(";")).values(M.join(";"))}s.push(g),g.attachTo(this)}}},o=r=>{A(r)&&(r=JSON.parse("{"+r.replace(/\s*\(\s*/g,":[").replace(/\s*\)\s*/g,"],").split(/\s*,\s*|\s.*/).join(",").replace(/(\w+):/g,'"$1":').replace(/,$/,"")+"}"));let c="";for(let p in r)if(p===it){let d=l(r[p]);d.length>1&&(c+=`${H}(${d[1]}${D},${d[2]}${D}) `),c+=`${p}(${d[0]}${T(p)}) `,d.length>1&&(c+=`${H}(-${d[1]}${D},-${d[2]}${D}) `)}else c+=`${p}(${l(r[p]).map(d=>d+T(p)).join(",")}) `;return c},l=r=>k(r)?r:String(r).split(/\s+|,/),T=r=>xt.includes(r)?Et:r===H?D:"",w=r=>A(r)?r.replace(/(deg)|(px)/g,"").trim():r,x=r=>r.replace(/(path\s*\(\s*["'])|(["']\s*\)\s*$)/g,"").trim().replace(/([a-zA-Z])\s*/g,"$1").replace(/\s+/g,","),$=f(e),y=a(t),E=this._el.animate(y,$);return E.ready.then(()=>L(n)&&n.call(this,E)),E.finished.then(()=>{let r=y[y.length-1];for(let c in r){let p=At(c);/^text-/.test(p)?this._el.style[c]=r[c]:c!==Nt&&c in r&&this._el.setAttribute(p,p===tt?x(r[c]):w(r[c]))}s.forEach(c=>{c[nt](!0);let p=this._el.querySelectorAll(b),d=this._el.querySelectorAll(`${b}[${nt}]`);p.length===d.length&&p.forEach(N=>N.remove())}),L(i)&&i.call(this,E)}),this}function ot(t){t.extendInstance({animateTo:Ot})}var st=Symbol(),ct=Symbol(),O=Symbol(),C=Symbol(),U=Symbol(),Tt="unknown",ft="Graphane SVG Template Engine:",Q=[];I({name:"g-content",execute(t,{expression:e,data:n,evalExpression:i}){t.content(i(e,n))}});I({name:"g-if",execute(t,{expression:e,data:n,evalExpression:i}){t.style.visibility(i(e,n)?"inherit":"hidden")}});I({name:"g-bind",alias:":",argument:!0,execute(t,{expression:e,argument:n,data:i,evalExpression:u}){let f={...i,$:{...i.$,dynamic(s,m=200,o=0){t.animateTo((k(s)?s:[s]).map(l=>S(l)&&"offset"in l?{[n]:l.value,offset:l.offset}:{[n]:l}),{duration:m,delay:o})}},$$:n==="d"?t.$d:n==="transform"?t.$transform:void 0},a=u(e,f);if(n==="class"){if(k(a)){t.classList.add(...a.filter(s=>!!s));return}if(S(a)){Object.entries(a).forEach(([s,m])=>{m?t.classList.add(s):t.classList.remove(s)});return}a&&t.classList.add(a);return}if(n==="style"){Object.entries(a).forEach(([s,m])=>t.style[s](m));return}_(a)||t[n](n==="d"||n==="transform"?""+a:a)}});I({name:"g-on",alias:"@",argument:!0,execute(t,{expression:e,argument:n,data:i,evalExpression:u}){t[U]=t[U]||{};let f=t[U][n]=t[U][n]||new Map;f.has(e)&&t.removeEventListener(n,f.get(e));let a=function(s){let m=u(e,i);L(m)&&m.call(t,s)};t.addEventListener(n,a),f.set(e,a),n==="init"&&!t[st]&&(t[st]=!0,t.dispatchEvent(new Event("init")))}});I({name:"g-for",template:!0,execute(t,{expression:e,data:n}){t[O]=t[O]||[];let i=0;kt(e,n,u=>{if(t[O][i])P(t[O][i],u,!1);else{let f=t.gSVG("g");t.children().forEach(a=>{f.add(a.cloneNode(!0))}),P(f,u),t.before(f.el),f[ct]=!0,t[O].push(f)}i++},u=>{for(;t[O].length>u.length;)t[O].pop().remove()})}});function I({name:t,alias:e,argument:n,template:i,execute:u}){let f=`^(${t}${n?":":""}${e?`|${e})`:")"}${n?"(.*)$":"$"}`,a=new RegExp(f,"i");Q.push({name:t,alias:e,argument:n,template:i,execute:u,check:a})}function wt(t){for(let e of Q){let n=e.check.exec(t);if(n){let i=n[2];return{...e,argument:i}}}}function Lt(t){return t.replace(/[{}()[\]]/g,"").split(",").map(e=>e.includes(":")?e.split(":")[1]:e).map(e=>e.trim())}function _t(t){return t[Symbol.iterator]?{iterator:[...t],type:q}:v(t)?{iterator:Array(t<0?0:t).fill(0).map((e,n)=>n),type:R}:S(t)?{iterator:Object.entries(t).map(e=>e.reverse()),type:F}:{iterator:t,type:Tt}}function ut(t,e){try{return B(Object.keys(e).filter(i=>!v(i)),`return ( ${t} ); `)(...Object.values(e))}catch(n){console.warn(ft,n.message)}}function kt(t,e,n,i){let u="__$$iterator",f="__$$callback",a="__$$final";try{let[s,m]=t.split(" of ");s=s.trim(),m=m.trim();let o=ut(m,e)||[],{iterator:l,type:T}=_t(o);T===F&&!s.startsWith("[")&&(s=`[${s.replace(/(^\()|(\)$)/g,"")}]`);let w=Lt(s),x=s.startsWith("(")?s:`(${s})`,$=Object.keys(e),y=` ${u}.forEach(${x} => { ${f}({${$}${$.length?",":""}${w.join(",")}}); }); ${a}(${u}); `;return B([...$,u,f,a],y)(...Object.values(e),l,n,i)}catch(s){console.warn(ft,s)}}function P(t,e,n=!0){if(n&&t[ct])return;t[C]=t[C]||[];let i=t.attributes();for(let f of[...i]){let a=f.name,s=wt(a);s&&(t[C].push({...s,expression:f.value}),t.removeAttribute(a))}let u=!1;for(let f of t[C])f.execute(t,{...f,data:e,evalExpression:ut}),u=f.template||u;if(!u)for(let f of t.children())P(f,e)}function It(t={}){P(this,{...t,...Array.isArray(t.data)?{}:t.data,$:t.data?{...t.$,...X(t.data),data:t.data,rawData:V(t.data)}:{}})}function Ht(t){t.install(ot),t.extendInstance({render:It}),t.extendSetup({extendTemplate:{defineDirective:I,obtainDirective(e){return Q.find(n=>n.name===e)}}})}export{Ht as svgPlugin}; //# sourceMappingURL=template.engine.js.map