/* graphane - 0.1.0-alpha.5 */ var at="function",ft="undefined",k="object",ut="string",H="array",C="number";var N=t=>typeof t===k,G=t=>typeof t===ut,A=t=>typeof t===at,W=t=>typeof t===C&&!isNaN(t),Z=t=>typeof t===ft;var E=t=>Array.isArray(t);var V=new Map;var lt=async function(){}.constructor;function P(t,e,r=!1){let i=`${t.join(",")} ${e}`;if(V.has(i))return V.get(i);let f=new(r?lt:Function)(...t,e);return V.set(i,f),f}function U(t){try{return new Function(`let ${t} = 0`),!0}catch{return!1}}var K="SVG",B="animate",pt="none",mt="freeze",ht="path",q="d",v="transform",et="rotate",J="translate",dt="offset",Q="inherit",X="finished",$t=[et,"skewX","skewY"],xt="deg",T="px",tt="ms",yt=["width","height"],z=!1;if(window.matchMedia){let t=window.matchMedia("(prefers-reduced-motion: reduce)");z=t.matches,t.addEventListener("change",()=>{z=t.matches})}var gt=t=>t.replace(/([A-Z])/g,"-$1").toLowerCase();function Nt(t,e={duration:200},r=null,i=null){let f=this.gSVG,c=n=>{let o=N(n)?Object.assign({},n):{duration:n};return z&&(o.duration=0),o.fill=pt,o},u=n=>{n=E(n)?n:[n];let o=window.getComputedStyle(this._el),s=[],l=new Set;for(let $ of n){let h=Object.assign({},$);for(let m in h)!(m in o)||yt.includes(m)?l.add(m):m===q?h.d=`${ht}("${h.d}")`:m===v&&(h.transform=S(h.transform));s.push(h)}return p(l,s),s},a=[],p=(n,o)=>{if(n.size){let s=new KeyframeEffect(null,o).getKeyframes(),l=this.closest(K)?this.closest(K).getCurrentTime()*1e3:0;for(let $ of n){let h=f(B).attributeName($).dur(_.duration+tt).begin((0|l+(e.delay||0))+tt).fill(mt);if(o.length===1)h.to(o[0][$]);else{let m=[],F=[];for(let j in s){let ct=s[j];$ in o[j]&&(m.push(ct.computedOffset),F.push(o[j][$]))}m[0]!==0&&(m.unshift(0),F.unshift(this[$]()||Q)),m[m.length-1]!==1&&(m.push(1),F.push(this[$]()||Q)),h.keyTimes(m.join(";")).values(F.join(";"))}a.push(h),h.attachTo(this)}}},S=n=>{G(n)&&(n=JSON.parse("{"+n.replace(/\s*\(\s*/g,":[").replace(/\s*\)\s*/g,"],").split(/\s*,\s*|\s.*/).join(",").replace(/(\w+):/g,'"$1":').replace(/,$/,"")+"}"));let o="";for(let s in n)if(s===et){let l=d(n[s]);l.length>1&&(o+=`${J}(${l[1]}${T},${l[2]}${T}) `),o+=`${s}(${l[0]}${w(s)}) `,l.length>1&&(o+=`${J}(-${l[1]}${T},-${l[2]}${T}) `)}else o+=`${s}(${d(n[s]).map(l=>l+w(s)).join(",")}) `;return o},d=n=>E(n)?n:String(n).split(/\s+|,/),w=n=>$t.includes(n)?xt:n===J?T:"",L=n=>G(n)?n.replace(/(deg)|(px)/g,"").trim():n,D=n=>n.replace(/(path\s*\(\s*["'])|(["']\s*\)\s*$)/g,"").trim().replace(/([a-zA-Z])\s*/g,"$1").replace(/\s+/g,","),y=n=>{let o=/translate\((.*)px,(.*)px\) rotate\((.*)deg\) translate\((.*)px,(.*)px\)\s+/,s=o.exec(n);return s&&Number(s[1])===Number(s[4])*-1&&Number(s[2])===Number(s[5])*-1?n=n.replace(o,`rotate(${s[3]}, ${s[1]}, ${s[2]})`):n=L(n),n},_=c(e),O=u(t),g=this._el.animate(O,_);return g.ready.then(()=>A(r)&&r.call(this,g)),g.finished.then(()=>{let n=O[O.length-1];for(let o in n){let s=gt(o);s.startsWith("text-")?this._el.style[o]=n[o]:o!==dt&&o in n&&this._el.setAttribute(s,s===q?D(n[o]):s===v?y(n[o]):L(n[o]))}a.forEach(o=>{o[X](!0);let s=this._el.querySelectorAll(B),l=this._el.querySelectorAll(`${B}[${X}]`);s.length===l.length&&s.forEach($=>$.remove())}),A(i)&&i.call(this,g)}),this}function nt(t){t.extendInstance({animateTo:Nt})}var rt=Symbol(),it=Symbol(),x=Symbol(),I=Symbol(),M=Symbol(),Et="unknown",ot="Graphane SVG Template Engine:",Y=[];b({name:"g-content",execute(t,{expression:e,data:r,evalExpression:i}){t.content(i(e,r))}});b({name:"g-if",execute(t,{expression:e,data:r,evalExpression:i}){t.style.visibility(i(e,r)?"inherit":"hidden")}});b({name:"g-bind",alias:":",argument:!0,execute(t,{expression:e,argument:r,data:i,evalExpression:f}){let c={...i,$$:["d","transform"].includes(r)?t["$"+r]:()=>t[r]()};c.$$.dynamic=(a,p=200,S=0)=>{t.animateTo((E(a)?a:[a]).map(d=>N(d)&&"offset"in d?{[r]:d.value,offset:d.offset}:{[r]:d}),{duration:p,delay:S})};let u=f(e,c);if(r==="class"){if(E(u)){t.classList.add(...u.filter(a=>!!a));return}if(N(u)){Object.entries(u).forEach(([a,p])=>{p?t.classList.add(a):t.classList.remove(a)});return}u&&t.classList.add(u);return}if(r==="style"){Object.entries(u).forEach(([a,p])=>t.style[a](p));return}Z(u)||t[r](u)}});b({name:"g-on",alias:"@",argument:!0,execute(t,{expression:e,argument:r,data:i,evalExpression:f}){t[M]=t[M]||{};let c=t[M][r]=t[M][r]||new Map;c.has(e)&&t.removeEventListener(r,c.get(e));let u=function(a){let p=f(e,i,t);A(p)&&p.call(t,a)};t.addEventListener(r,u),c.set(e,u),r==="init"&&!t[rt]&&(t[rt]=!0,t.dispatchEvent(new Event("init")))}});b({name:"g-for",template:!0,execute(t,{expression:e,data:r}){t[x]=t[x]||[];let i=0;Tt(e,r,f=>{if(t[x][i])R(t[x][i],f,!1);else{let c=t.gSVG("g");t.children().forEach(u=>{c.add(u.cloneNode(!0))}),R(c,f),t.before(c.el),c[it]=!0,t[x].push(c)}i++},f=>{for(;t[x].length>f.length;)t[x].pop().remove()})}});function b({name:t,alias:e,argument:r,template:i,execute:f}){let c=`^(${t}${r?":":""}${e?`|${e})`:")"}${r?"(.*)$":"$"}`,u=new RegExp(c,"i");Y.push({name:t,alias:e,argument:r,template:i,execute:f,check:u})}function bt(t){for(let e of Y){let r=e.check.exec(t);if(r){let i=r[2];return{...e,argument:i}}}}function St(t){return t.replace(/[{}()[\]]/g,"").split(",").map(e=>e.includes(":")?e.split(":")[1]:e).map(e=>e.trim())}function At(t){return t[Symbol.iterator]?{iterator:[...t],type:H}:W(t)?{iterator:Array(t<0?0:0|t).fill(0).map((e,r)=>r),type:C}:N(t)?{iterator:Object.entries(t).map(e=>e.reverse()),type:k}:{iterator:t,type:Et}}function st(t,e,r=null){try{let i=Object.keys(e).filter(U);return P(i,`return ( ${t} ); `).apply(r,i.map(c=>e[c]))}catch(i){console.warn(ot,i.message,` `,t)}}function Tt(t,e,r,i){let f="__$$iterator",c="__$$callback",u="__$$final";try{let[a,p]=t.split(" of ");a=a.trim(),p=p.trim();let S=st(p,e)||[],{iterator:d,type:w}=At(S);w===k&&!a.startsWith("[")&&(a=`[${a.replace(/(^\()|(\)$)/g,"")}]`);let L=St(a),D=a.startsWith("(")?a:`(${a})`,y=Object.keys(e).filter(U),_=` ${f}.forEach(${D} => { ${c}({${y}${y.length?",":""}${L.join(",")}}); }); ${u}(${f}); `;return P([...y,f,c,u],_)(...y.map(g=>e[g]),d,r,i)}catch(a){console.warn(ot,a)}}function R(t,e,r=!0){if(r&&t[it])return;t[I]=t[I]||[];let i=t.attributes();for(let c of[...i]){let u=c.name,a=bt(u);a&&(t[I].push({...a,expression:c.value}),t.removeAttribute(u))}let f=!1;for(let c of t[I])c.execute(t,{...c,data:e,evalExpression:st}),f=c.template||f;if(!f)for(let c of t.children())R(c,e)}function wt(t={}){R(this,t),this.dispatchEvent(new Event("render"))}function jt(t){t.install(nt),t.extendInstance({render:wt}),t.extendSetup({extendTemplate:{defineDirective:b,obtainDirective(e){return Y.find(r=>r.name===e)}}})}export{jt as svgPlugin}; //# sourceMappingURL=template.engine.js.map