/* graphane - 0.1.0-alpha.5 */ var ot="function",st="undefined",O="object",ct="string",Y="array",D="number";var y=t=>typeof t===O,C=t=>typeof t===ct,T=t=>typeof t===ot,G=t=>typeof t===D&&!isNaN(t),H=t=>typeof t===st;var N=t=>Array.isArray(t);var P=new Map;function U(t,e){let n=`${t.join(",")} ${e}`;if(P.has(n))return P.get(n);let o=new Function(...t,e);return P.set(n,o),o}var v="SVG",V="animate",ft="none",at="freeze",ut="path",Z="d",lt="transform",Q="rotate",B="translate",pt="offset",K="inherit",W="finished",mt=[Q,"skewX","skewY"],dt="deg",w="px",q="ms",ht=["width","height"],J=!1;if(window.matchMedia){let t=window.matchMedia("(prefers-reduced-motion: reduce)");J=t.matches,t.addEventListener("change",()=>{J=t.matches})}var $t=t=>t.replace(/([A-Z])/g,"-$1").toLowerCase();function xt(t,e={duration:200},n=null,o=null){let u=this.gSVG,s=r=>{let c=y(r)?Object.assign({},r):{duration:r};return J&&(c.duration=0),c.fill=ft,c},f=r=>{r=N(r)?r:[r];let c=window.getComputedStyle(this._el),a=[],l=new Set;for(let $ of r){let d=Object.assign({},$);for(let m in d)!(m in c)||ht.includes(m)?l.add(m):m===Z?d.d=`${ut}("${d.d}")`:m===lt&&(d.transform=b(d.transform));a.push(d)}return p(l,a),a},i=[],p=(r,c)=>{if(r.size){let a=new KeyframeEffect(null,c).getKeyframes(),l=this.closest(v)?this.closest(v).getCurrentTime()*1e3:0;for(let $ of r){let d=u(V).attributeName($).dur(g.duration+q).begin((0|l+(e.delay||0))+q).fill(at);if(c.length===1)d.to(c[0][$]);else{let m=[],_=[];for(let R in a){let it=a[R];$ in c[R]&&(m.push(it.computedOffset),_.push(c[R][$]))}m[0]!==0&&(m.unshift(0),_.unshift(this[$]()||K)),m[m.length-1]!==1&&(m.push(1),_.push(this[$]()||K)),d.keyTimes(m.join(";")).values(_.join(";"))}i.push(d),d.attachTo(this)}}},b=r=>{C(r)&&(r=JSON.parse("{"+r.replace(/\s*\(\s*/g,":[").replace(/\s*\)\s*/g,"],").split(/\s*,\s*|\s.*/).join(",").replace(/(\w+):/g,'"$1":').replace(/,$/,"")+"}"));let c="";for(let a in r)if(a===Q){let l=h(r[a]);l.length>1&&(c+=`${B}(${l[1]}${w},${l[2]}${w}) `),c+=`${a}(${l[0]}${L(a)}) `,l.length>1&&(c+=`${B}(-${l[1]}${w},-${l[2]}${w}) `)}else c+=`${a}(${h(r[a]).map(l=>l+L(a)).join(",")}) `;return c},h=r=>N(r)?r:String(r).split(/\s+|,/),L=r=>mt.includes(r)?dt:r===B?w:"",k=r=>C(r)?r.replace(/(deg)|(px)/g,"").trim():r,I=r=>r.replace(/(path\s*\(\s*["'])|(["']\s*\)\s*$)/g,"").trim().replace(/([a-zA-Z])\s*/g,"$1").replace(/\s+/g,","),g=s(e),S=f(t),A=this._el.animate(S,g);return A.ready.then(()=>T(n)&&n.call(this,A)),A.finished.then(()=>{let r=S[S.length-1];for(let c in r){let a=$t(c);/^text-/.test(a)?this._el.style[c]=r[c]:c!==pt&&c in r&&this._el.setAttribute(a,a===Z?I(r[c]):k(r[c]))}i.forEach(c=>{c[W](!0);let a=this._el.querySelectorAll(V),l=this._el.querySelectorAll(`${V}[${W}]`);a.length===l.length&&a.forEach($=>$.remove())}),T(o)&&o.call(this,A)}),this}function X(t){t.extendInstance({animateTo:xt})}var tt=Symbol(),et=Symbol(),x=Symbol(),F=Symbol(),M=Symbol(),gt="unknown",nt="Graphane SVG Template Engine:",z=[];E({name:"g-content",execute(t,{expression:e,data:n,evalExpression:o}){t.content(o(e,n))}});E({name:"g-if",execute(t,{expression:e,data:n,evalExpression:o}){t.style.visibility(o(e,n)?"inherit":"hidden")}});E({name:"g-bind",alias:":",argument:!0,execute(t,{expression:e,argument:n,data:o,evalExpression:u}){let s={...o,$:{...o.$,dynamic(i,p=200,b=0){t.animateTo((N(i)?i:[i]).map(h=>y(h)&&"offset"in h?{[n]:h.value,offset:h.offset}:{[n]:h}),{duration:p,delay:b})}},$$:n==="d"?t.$d:n==="transform"?t.$transform:void 0},f=u(e,s);if(n==="class"){if(N(f)){t.classList.add(...f.filter(i=>!!i));return}if(y(f)){Object.entries(f).forEach(([i,p])=>{p?t.classList.add(i):t.classList.remove(i)});return}f&&t.classList.add(f);return}if(n==="style"){Object.entries(f).forEach(([i,p])=>t.style[i](p));return}H(f)||t[n](f)}});E({name:"g-on",alias:"@",argument:!0,execute(t,{expression:e,argument:n,data:o,evalExpression:u}){t[M]=t[M]||{};let s=t[M][n]=t[M][n]||new Map;s.has(e)&&t.removeEventListener(n,s.get(e));let f=function(i){let p=u(e,o);T(p)&&p.call(t,i)};t.addEventListener(n,f),s.set(e,f),n==="init"&&!t[tt]&&(t[tt]=!0,t.dispatchEvent(new Event("init")))}});E({name:"g-for",template:!0,execute(t,{expression:e,data:n}){t[x]=t[x]||[];let o=0;bt(e,n,u=>{if(t[x][o])j(t[x][o],u,!1);else{let s=t.gSVG("g");t.children().forEach(f=>{s.add(f.cloneNode(!0))}),j(s,u),t.before(s.el),s[et]=!0,t[x].push(s)}o++},u=>{for(;t[x].length>u.length;)t[x].pop().remove()})}});function E({name:t,alias:e,argument:n,template:o,execute:u}){let s=`^(${t}${n?":":""}${e?`|${e})`:")"}${n?"(.*)$":"$"}`,f=new RegExp(s,"i");z.push({name:t,alias:e,argument:n,template:o,execute:u,check:f})}function yt(t){for(let e of z){let n=e.check.exec(t);if(n){let o=n[2];return{...e,argument:o}}}}function Nt(t){return t.replace(/[{}()[\]]/g,"").split(",").map(e=>e.includes(":")?e.split(":")[1]:e).map(e=>e.trim())}function Et(t){return t[Symbol.iterator]?{iterator:[...t],type:Y}:G(t)?{iterator:Array(t<0?0:t).fill(0).map((e,n)=>n),type:D}:y(t)?{iterator:Object.entries(t).map(e=>e.reverse()),type:O}:{iterator:t,type:gt}}function rt(t,e){try{return U(Object.keys(e).filter(o=>!G(o)),`return ( ${t} ); `)(...Object.values(e))}catch(n){console.warn(nt,n.message)}}function bt(t,e,n,o){let u="__$$iterator",s="__$$callback",f="__$$final";try{let[i,p]=t.split(" of ");i=i.trim(),p=p.trim();let b=rt(p,e)||[],{iterator:h,type:L}=Et(b);L===O&&!i.startsWith("[")&&(i=`[${i.replace(/(^\()|(\)$)/g,"")}]`);let k=Nt(i),I=i.startsWith("(")?i:`(${i})`,g=Object.keys(e),S=` ${u}.forEach(${I} => { ${s}({${g}${g.length?",":""}${k.join(",")}}); }); ${f}(${u}); `;return U([...g,u,s,f],S)(...Object.values(e),h,n,o)}catch(i){console.warn(nt,i)}}function j(t,e,n=!0){if(n&&t[et])return;t[F]=t[F]||[];let o=t.attributes();for(let s of[...o]){let f=s.name,i=yt(f);i&&(t[F].push({...i,expression:s.value}),t.removeAttribute(f))}let u=!1;for(let s of t[F])s.execute(t,{...s,data:e,evalExpression:rt}),u=s.template||u;if(!u)for(let s of t.children())j(s,e)}function St(t={}){j(this,t),this.dispatchEvent(new Event("render"))}function Mt(t){t.install(X),t.extendInstance({render:St}),t.extendSetup({extendTemplate:{defineDirective:E,obtainDirective(e){return z.find(n=>n.name===e)}}})}export{Mt as svgPlugin}; //# sourceMappingURL=template.engine.js.map