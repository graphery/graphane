/* graphane - 0.1.0-alpha.5 */ var x=new WeakSet;function k(s){if(x.has(s))return;let t=s.getScreenCTM(),n=()=>{let i=s.getScreenCTM();i!==null&&(i.a!==t.a||i.b!==t.b||i.c!==t.c||i.d!==t.d||i.e!==t.e||i.f!==t.f)&&(s.dispatchEvent(new CustomEvent("resize",{detail:{currentMatrix:i,prevMatrix:t}})),t=i),window.requestAnimationFrame(n)};x.add(s),n()}function C(s,...t){s==="resize"&&this.el.tagName.toLowerCase()==="svg"&&k(this.el),this.el.addEventListener(s,...t)}function v(s){s.extendInstance(t=>{let n=t.addEventListener;t.addEventListener=function(...i){C.call(this,...i),n&&e.call(this,...i)}})}var c=Symbol(),E=s=>s?.split(/\)\s*/).filter(t=>!!t).map(t=>t.split(/\s*\(/)).reduce((t,n)=>(t[n.shift()]=n.pop().split(/,/).map(i=>Number.isNaN(Number(i))?i:Number(i)),t),{})||{};function h(s="size"){let t=this.closest("svg");return t?t._el.getRootNode()===t._el?(t.addEventListener("attach",n=>{h.call(this,s)}),this):(this[c]&&t.removeEventListener("resize",this[c]),s==="stroke"&&b(t,this),s==="size"&&M(t,this),s&&t.addEventListener("resize",this[c]),this):(this.top().addEventListener("attach",n=>{h.call(this,s)}),this)}function M(s,t){let n=s.getScreenCTM()||{a:1,d:1},i=t.tagName().toLowerCase(),r=i==="text"?{x:t.x(),y:t.y()}:i==="circle"?{x:t.cx(),y:t.cy()}:t.getBBox(),a=E(t.transform());a.scale||(a.scale=[1,1]),a.translate||(a.translate=[0,0]),n.a=n.a*a.scale[0],n.d=n.d*a.scale[1],t[c]=p=>{let o=p.detail.currentMatrix,l=t.transform("").transform,u=n.a/o.a,m=n.d/o.d,g=r.x*(o.a/n.a)-r.x,f=r.y*(o.d/n.d)-r.y;Object.keys(a).filter(d=>!["scale","translate"].includes(d)).forEach(d=>l[d](...a[d])),(u!==1||m!==1)&&l.scale(u,m),(f!==0||f!==0)&&l.translate(g,f)}}function b(s,t){let n=s.getScreenCTM()||{a:1,d:1};t.el._strokeWidth=parseFloat(getComputedStyle(t._el).strokeWidth),t[c]=i=>{let r=i.detail.currentMatrix;t.style.strokeWidth(t.el._strokeWidth*Math.max(n.a/r.a,n.d/r.d))}}function L(s){s.install(v),s.extendInstance({keepAspect:h}),s.extendTemplate&&s.extendTemplate.defineDirective({name:"g-keep-aspect",execute(t,{expression:n}){t.keepAspect(n)}})}export{L as svgPlugin}; //# sourceMappingURL=keep.aspect.js.map